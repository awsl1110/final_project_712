import{d as S,r as V,j as z,n as P,p as C,o as R,q as j,w as t,b as e,u as s,e as r,f as c,t as b,s as q,g as D,E as i,h as o,v as F,x as G,y as H,z as J,A as K,B as L,C as O,_ as Q}from"./index-BekgHCmB.js";import{u as W}from"./user-DuJHeInz.js";const X={class:"header-right"},Y={class:"el-dropdown-link"},Z={class:"username"},$=S({__name:"index",setup(ee){const A=q(),g=D(),n=W(),w=V();z(()=>n.token,_=>{_&&C(()=>{setTimeout(()=>{n.fetchAvatar().catch(()=>{})},1e3)})}),P(()=>{n.token&&C(()=>{setTimeout(()=>{n.fetchAvatar().catch(()=>{})},1e3)})});const T=_=>{var a;switch(_){case"profile":g.push("/profile");break;case"upload":(a=w.value)==null||a.click();break;case"password":g.push("/password");break;case"logout":n.logout(),g.push("/login");break}},B=async _=>{var u,f;const a=_.target,l=(u=a.files)==null?void 0:u[0];if(l){const p=i.info({message:"正在上传头像，请稍候...",duration:0});try{const d=await n.uploadAvatar(l);p.close(),d===!0?i.success("头像上传成功"):i.warning("头像可能已上传，请刷新页面查看")}catch(d){console.error("上传错误:",d),p.close(),n.avatarUrl?i.success("头像上传成功"):((f=d.message)!=null&&f.includes("请刷新页面")?i.warning(d.message):d.message?i.error(d.message):i.error("头像上传失败，请重试"),setTimeout(()=>{n.fetchAvatar().catch(()=>{})},1e3))}}a.value=""};return(_,a)=>{const l=o("el-icon"),u=o("el-menu-item"),f=o("el-menu"),p=o("el-aside"),d=o("el-avatar"),m=o("el-dropdown-item"),U=o("el-dropdown-menu"),E=o("el-dropdown"),I=o("el-header"),M=o("router-view"),N=o("el-main"),v=o("el-container");return R(),j(v,{class:"layout-container"},{default:t(()=>[e(p,{width:"200px"},{default:t(()=>[e(f,{"default-active":s(A).path,class:"el-menu-vertical",router:""},{default:t(()=>[e(u,{index:"/dashboard"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(F))]),_:1}),a[0]||(a[0]=r("span",null,"首页",-1))]),_:1}),e(u,{index:"/products"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(G))]),_:1}),a[1]||(a[1]=r("span",null,"商品列表",-1))]),_:1}),e(u,{index:"/cart"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(H))]),_:1}),a[2]||(a[2]=r("span",null,"购物车",-1))]),_:1}),e(u,{index:"/orders"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(J))]),_:1}),a[3]||(a[3]=r("span",null,"我的订单",-1))]),_:1}),e(u,{index:"/favorites"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(K))]),_:1}),a[4]||(a[4]=r("span",null,"我的收藏",-1))]),_:1}),e(u,{index:"/coupons"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(L))]),_:1}),a[5]||(a[5]=r("span",null,"优惠券中心",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(v,null,{default:t(()=>[e(I,null,{default:t(()=>[r("div",X,[e(E,{onCommand:T},{dropdown:t(()=>[e(U,null,{default:t(()=>[e(m,{command:"profile"},{default:t(()=>a[6]||(a[6]=[c("个人信息")])),_:1}),e(m,{command:"upload"},{default:t(()=>a[7]||(a[7]=[c("上传头像")])),_:1}),e(m,{command:"password"},{default:t(()=>a[8]||(a[8]=[c("修改密码")])),_:1}),e(m,{command:"logout"},{default:t(()=>a[9]||(a[9]=[c("退出登录")])),_:1})]),_:1})]),default:t(()=>{var x;return[r("span",Y,[e(d,{size:32,class:"user-avatar",src:s(n).avatarUrl,onError:()=>!0},{default:t(()=>{var k,h,y;return[c(b((y=(h=(k=s(n).userProfile)==null?void 0:k.name)==null?void 0:h.charAt(0))==null?void 0:y.toUpperCase()),1)]}),_:1},8,["src"]),r("span",Z,b((x=s(n).userProfile)==null?void 0:x.name),1),e(l,{class:"el-icon--right"},{default:t(()=>[e(s(O))]),_:1})])]}),_:1})])]),_:1}),e(N,null,{default:t(()=>[e(M)]),_:1})]),_:1}),r("input",{type:"file",ref_key:"fileInput",ref:w,style:{display:"none"},accept:"image/*",onChange:B},null,544)]),_:1})}}}),oe=Q($,[["__scopeId","data-v-b4dee6b1"]]);export{oe as default};
