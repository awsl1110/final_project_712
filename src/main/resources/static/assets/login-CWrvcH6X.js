import{d as q,r as _,a as B,o as E,c as N,b as o,w as a,e as r,u as n,f as k,g as R,E as u,h as t,i as S,l as $,k as D,_ as F}from"./index-D07GUNLX.js";import{u as I}from"./user-B44x33Ff.js";const L={class:"login-container"},M={class:"captcha-container"},T=["src"],j={class:"register-link"},z=q({__name:"login",setup(A){const f=R(),V=I(),c=_(!1),g=_("/api/kaptcha/code"),s=B({username:"",password:"",captcha:""}),w={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:4,max:4,message:"验证码长度必须为4位",trigger:"blur"}]},h=()=>{g.value=`/api/kaptcha/code?t=${Date.now()}`},v=_(),x=async()=>{var d;try{await((d=v.value)==null?void 0:d.validate()),c.value=!0,console.log("登录参数:",s),await V.login(s),u.success("登录成功"),f.push("/")}catch(e){console.error("登录错误:",e),e.captcha?u.error("请输入正确的验证码"):e.message?u.error(e.message):u.error("登录失败"),h()}finally{c.value=!1}};return(d,e)=>{const i=t("el-icon"),p=t("el-input"),m=t("el-form-item"),y=t("el-button"),b=t("el-form"),C=t("el-link"),U=t("el-card");return E(),N("div",L,[o(U,{class:"login-box"},{header:a(()=>e[4]||(e[4]=[r("div",{class:"header"},[r("span",{class:"title"},"用户登录")],-1)])),default:a(()=>[o(b,{ref_key:"formRef",ref:v,model:s,rules:w},{default:a(()=>[o(m,{prop:"username"},{default:a(()=>[o(p,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=l=>s.username=l),placeholder:"用户名"},{prefix:a(()=>[o(i,null,{default:a(()=>[o(n(S))]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(m,{prop:"password"},{default:a(()=>[o(p,{modelValue:s.password,"onUpdate:modelValue":e[1]||(e[1]=l=>s.password=l),type:"password",placeholder:"密码"},{prefix:a(()=>[o(i,null,{default:a(()=>[o(n($))]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(m,{prop:"captcha"},{default:a(()=>[r("div",M,[o(p,{modelValue:s.captcha,"onUpdate:modelValue":e[2]||(e[2]=l=>s.captcha=l),placeholder:"验证码"},{prefix:a(()=>[o(i,null,{default:a(()=>[o(n(D))]),_:1})]),_:1},8,["modelValue"]),r("img",{src:g.value,alt:"验证码",class:"captcha-img",onClick:h},null,8,T)])]),_:1}),o(y,{type:"primary",class:"login-button",onClick:x,loading:c.value},{default:a(()=>e[5]||(e[5]=[k(" 登录 ")])),_:1},8,["loading"])]),_:1},8,["model"]),r("div",j,[o(C,{type:"primary",onClick:e[3]||(e[3]=l=>n(f).push("/register"))},{default:a(()=>e[6]||(e[6]=[k("还没有账号？立即注册")])),_:1})])]),_:1})])}}}),J=F(z,[["__scopeId","data-v-c4956f43"]]);export{J as default};
