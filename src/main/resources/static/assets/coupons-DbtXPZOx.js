import{a as b,r as D}from"./coupon-MfualckF.js";import{d as S,r as y,n as x,o as c,c as d,e as s,b as m,w as _,I as B,q as k,u as N,G as T,H as $,E as o,h as f,J as E,B as I,t as l,f as M,U as V,_ as z}from"./index-BekgHCmB.js";import"./user-DuJHeInz.js";const A={class:"coupons-container"},F={class:"page-header"},q={class:"coupons-content"},G={key:1,class:"coupon-list"},H={class:"coupon-content"},J={class:"coupon-value"},L={key:0,class:"amount"},R={key:1,class:"discount"},U={class:"coupon-info"},Y={class:"coupon-name"},j={class:"coupon-condition"},K={class:"coupon-time"},O={class:"coupon-remain"},P={class:"coupon-action"},Q=S({__name:"coupons",setup(W){const v=y([]),u=y(!0),g=n=>{if(!n)return"";const a=new Date(n);return isNaN(a.getTime())?"":`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},h=async()=>{var n,a,i;try{u.value=!0;const t=await b();t.data.code===200?v.value=t.data.data||[]:o.error(t.data.message||"获取优惠券列表失败")}catch(t){((n=t.response)==null?void 0:n.status)===401?o.error("请先登录"):(i=(a=t.response)==null?void 0:a.data)!=null&&i.message?o.error(t.response.data.message):o.error("获取优惠券列表失败")}finally{u.value=!1}},C=async n=>{var i,t,p;if(!localStorage.getItem("token")){o.warning("请先登录");return}if(n.remain<=0){o.warning("优惠券已被领完");return}try{const r=await D(n.id);r.data.code===200?(o.success(r.data.message||"领取成功"),h()):o.error(r.data.message||"领取失败")}catch(r){((i=r.response)==null?void 0:i.status)===401?o.error("请先登录"):(p=(t=r.response)==null?void 0:t.data)!=null&&p.message?o.error(r.response.data.message):o.error("领取失败，请稍后重试")}};return x(()=>{h()}),(n,a)=>{const i=f("el-card"),t=f("el-icon"),p=f("el-empty"),r=f("el-button"),w=E("loading");return c(),d("div",A,[s("div",F,[m(i,null,{default:_(()=>a[0]||(a[0]=[s("div",{class:"header"},[s("div",{class:"title-wrapper"},[s("span",{class:"title"},"优惠券中心"),s("span",{class:"subtitle"},"领取优惠券，享受优惠价格")])],-1)])),_:1})]),B((c(),d("div",q,[!u.value&&v.value.length===0?(c(),k(p,{key:0,description:"暂无可领取的优惠券"},{image:_(()=>[m(t,{size:60},{default:_(()=>[m(N(I))]),_:1})]),_:1})):(c(),d("div",G,[(c(!0),d(T,null,$(v.value,e=>(c(),k(i,{key:e.id,class:V(["coupon-card",{"coupon-disabled":e.remain<=0||e.status===0}])},{default:_(()=>[s("div",H,[s("div",J,[e.type===1?(c(),d("span",L,"¥"+l(e.value),1)):(c(),d("span",R,l(e.value)+"折",1))]),s("div",U,[s("h3",Y,l(e.name),1),s("p",j,"满"+l(e.minAmount)+"元可用",1),s("p",K,l(g(e.startTime))+" 至 "+l(g(e.endTime)),1),s("p",O,"剩余 "+l(e.remain)+" 张",1)]),s("div",P,[m(r,{type:"primary",disabled:e.remain<=0||e.status===0,onClick:X=>C(e)},{default:_(()=>[M(l(e.status===0?"已停用":e.remain>0?"立即领取":"已领完"),1)]),_:2},1032,["disabled","onClick"])])])]),_:2},1032,["class"]))),128))]))])),[[w,u.value]])])}}}),te=z(Q,[["__scopeId","data-v-709a316a"]]);export{te as default};
