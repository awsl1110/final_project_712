import{d as U,r as f,a as q,o as B,c as E,b as a,w as o,e as r,u,f as _,g as N,E as d,h as l,i as R,l as S,k as $,_ as D}from"./index-BekgHCmB.js";import{u as F}from"./user-DuJHeInz.js";const I={class:"login-container"},L={class:"captcha-container"},M=["src"],T={class:"register-text"},j=U({__name:"login",setup(z){const g=N(),w=F(),c=f(!1),v=f("/api/kaptcha/code"),s=q({username:"",password:"",captcha:""}),x={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:4,max:4,message:"验证码长度必须为4位",trigger:"blur"}]},h=()=>{v.value=`/api/kaptcha/code?t=${Date.now()}`},k=f(),y=async()=>{var i;try{await((i=k.value)==null?void 0:i.validate()),c.value=!0,console.log("登录参数:",s),await w.login(s),d.success("登录成功"),g.push("/")}catch(e){console.error("登录错误:",e),e.captcha?d.error("请输入正确的验证码"):e.message?d.error(e.message):d.error("登录失败"),h()}finally{c.value=!1}};return(i,e)=>{const p=l("el-icon"),m=l("el-input"),n=l("el-form-item"),V=l("el-button"),b=l("el-form"),C=l("el-card");return B(),E("div",I,[a(C,{class:"login-card"},{header:o(()=>e[4]||(e[4]=[r("div",{class:"card-header"},[r("span",null,"用户登录")],-1)])),default:o(()=>[a(b,{ref_key:"formRef",ref:k,model:s,rules:x,class:"login-form"},{default:o(()=>[a(n,{prop:"username"},{default:o(()=>[a(m,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=t=>s.username=t),placeholder:"用户名"},{prefix:o(()=>[a(p,null,{default:o(()=>[a(u(R))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(n,{prop:"password"},{default:o(()=>[a(m,{modelValue:s.password,"onUpdate:modelValue":e[1]||(e[1]=t=>s.password=t),type:"password",placeholder:"密码"},{prefix:o(()=>[a(p,null,{default:o(()=>[a(u(S))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(n,{prop:"captcha"},{default:o(()=>[r("div",L,[a(m,{modelValue:s.captcha,"onUpdate:modelValue":e[2]||(e[2]=t=>s.captcha=t),placeholder:"验证码"},{prefix:o(()=>[a(p,null,{default:o(()=>[a(u($))]),_:1})]),_:1},8,["modelValue"]),r("img",{src:v.value,onClick:h,class:"captcha-img",alt:"验证码"},null,8,M)])]),_:1}),a(n,null,{default:o(()=>[a(V,{type:"primary",loading:c.value,onClick:y,class:"login-button"},{default:o(()=>e[5]||(e[5]=[_(" 登录 ")])),_:1},8,["loading"]),r("div",T,[e[7]||(e[7]=_(" 没有账号？ ")),a(V,{link:"",type:"primary",onClick:e[3]||(e[3]=t=>u(g).push("/register"))},{default:o(()=>e[6]||(e[6]=[_(" 注册 ")])),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})])}}}),H=D(j,[["__scopeId","data-v-ee09e314"]]);export{H as default};
