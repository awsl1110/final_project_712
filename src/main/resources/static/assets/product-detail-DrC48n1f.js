import{d as F,r as _,D as L,n as q,o as a,c as l,b as v,w as f,e as s,t as i,K as C,F as T,G as U,E as p,h as d,q as b,_ as B,H as A,u as N,f as S,s as M,I as j,L as G,A as H,y as J}from"./index-Ba8PhKSB.js";import{c as K}from"./product-O-VhrwCb.js";import{a as O}from"./cart-Cx8k0y7Y.js";import{a as Y}from"./favorite-DTGhV1c6.js";import{g as Q}from"./review-1h7T61Bo.js";import"./user-CswI-_sj.js";const W={class:"product-reviews"},X={class:"review-header"},Z={key:0,class:"rating-summary"},ee={class:"review-count"},te={key:0,class:"loading-container"},se={key:1,class:"empty-reviews"},oe={key:2,class:"review-list"},ae={class:"review-item-header"},ne={class:"review-time"},re={class:"review-content"},le={key:0,class:"review-images"},ce={key:3,class:"pagination"},ie=F({__name:"ProductReviews",props:{productId:{}},setup(z){const V=z,m=_(!0),e=_([]),g=_(1),x=_(10),h=_(0),y=_(0),$=L(()=>{if(e.value.length===0)return 0;const o=e.value.reduce((c,u)=>c+u.rating,0);return Number((o/e.value.length).toFixed(1))}),D=o=>new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),n=async()=>{m.value=!0;try{const o=await Q(V.productId);if(o.data.code===200){const{records:c,totalPage:u,totalRow:w}=o.data.data;e.value=c,h.value=u,y.value=w}}catch(o){o.message==="此商品无评价"?(e.value=[],h.value=0,y.value=0):(p.error("获取商品评价失败"),console.error("获取商品评价失败:",o))}finally{m.value=!1}},t=o=>{g.value=o,n()};return q(()=>{n()}),(o,c)=>{const u=d("el-rate"),w=d("el-skeleton"),P=d("el-image"),I=d("el-pagination"),k=d("el-card");return a(),l("div",W,[v(k,{class:"review-card"},{header:f(()=>[s("div",X,[c[2]||(c[2]=s("span",{class:"title"},"商品评价",-1)),e.value.length>0?(a(),l("div",Z,[v(u,{modelValue:$.value,"onUpdate:modelValue":c[0]||(c[0]=r=>$.value=r),disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"},null,8,["modelValue"]),s("span",ee,"( "+i(e.value.length)+" 条评价 )",1)])):C("",!0)])]),default:f(()=>[m.value?(a(),l("div",te,[v(w,{rows:3,animated:""})])):e.value.length===0?(a(),l("div",se," 暂无评价 ")):(a(),l("div",oe,[(a(!0),l(T,null,U(e.value,r=>(a(),l("div",{key:r.id,class:"review-item"},[s("div",ae,[v(u,{modelValue:r.rating,"onUpdate:modelValue":R=>r.rating=R,disabled:""},null,8,["modelValue","onUpdate:modelValue"]),s("span",ne,i(D(r.createTime)),1)]),s("div",re,i(r.content),1),r.images?(a(),l("div",le,[(a(!0),l(T,null,U(r.images.split(","),(R,E)=>(a(),b(P,{key:E,src:R,"preview-src-list":r.images.split(","),fit:"cover",class:"review-image"},null,8,["src","preview-src-list"]))),128))])):C("",!0)]))),128))])),h.value>1?(a(),l("div",ce,[v(I,{"current-page":g.value,"onUpdate:currentPage":c[1]||(c[1]=r=>g.value=r),"page-size":x.value,total:y.value,onCurrentChange:t,layout:"prev, pager, next"},null,8,["current-page","page-size","total"])])):C("",!0)]),_:1})])}}}),de=B(ie,[["__scopeId","data-v-95d2771a"]]),ue={class:"product-detail-container"},pe={class:"product-content"},_e={class:"product-image"},ve=["src","alt"],me={class:"product-info"},ge={class:"product-name"},fe={class:"product-meta"},he={class:"brand"},ye={class:"model"},we={class:"product-price"},ke={class:"price"},be={class:"stock"},Ce={class:"product-description"},Ve={key:0,class:"product-specs"},$e={class:"product-actions"},Ne={class:"quantity-selector"},xe={class:"action-buttons"},De=F({__name:"product-detail",setup(z){const V=M(),m=_(!0),e=_(null),g=_(1),x=async()=>{try{m.value=!0;const n=Number(V.params.id),o=(await K(n)).data;o.code===200?e.value=o.data:p.error(o.message||"获取商品详情失败")}catch{p.error("获取商品详情失败")}finally{m.value=!1}},h=async()=>{if(e.value)try{const n={productId:e.value.id,quantity:g.value},t=await O(n);if(t.data){const o=t.data;o.code===200?p.success("添加到购物车成功"):p.error(o.message||"添加到购物车失败")}else p.error("添加到购物车失败")}catch{p.error("添加到购物车失败")}},y=async()=>{if(!e.value)return;if(!localStorage.getItem("token")){p.warning("请先登录");return}try{console.log("开始添加收藏，商品ID:",e.value.id);const t=await Y(e.value.id);console.log("收藏响应:",t),t.data.code===200&&p.success("收藏成功")}catch(t){console.error("收藏失败:",t),t.response&&console.error("错误响应:",t.response)}},$=n=>n==null?"¥0.00":n.toLocaleString("zh-CN",{style:"currency",currency:"CNY"}),D=n=>{if(!n)return{};try{return JSON.parse(n)}catch{return{}}};return q(()=>{x()}),(n,t)=>{const o=d("el-descriptions-item"),c=d("el-descriptions"),u=d("el-button"),w=d("el-card"),P=d("el-empty"),I=j("loading");return A((a(),l("div",ue,[e.value?(a(),b(w,{key:0,class:"product-detail"},{default:f(()=>[s("div",pe,[s("div",_e,[s("img",{src:e.value.imageUrl||"/default-product.jpg",alt:e.value.name},null,8,ve)]),s("div",me,[s("h1",ge,i(e.value.name),1),s("div",fe,[s("span",he,"品牌："+i(e.value.brand),1),s("span",ye,"型号："+i(e.value.model),1)]),s("div",we,[s("span",ke,i($(e.value.price)),1),s("span",be,"库存："+i(e.value.stock)+"件",1)]),s("div",Ce,[t[1]||(t[1]=s("h3",null,"商品描述",-1)),s("p",null,i(e.value.description),1)]),e.value.specifications?(a(),l("div",Ve,[t[2]||(t[2]=s("h3",null,"商品规格",-1)),v(c,{column:1,border:""},{default:f(()=>[(a(!0),l(T,null,U(D(e.value.specifications),(k,r)=>(a(),b(o,{key:r,label:r},{default:f(()=>[S(i(k),1)]),_:2},1032,["label"]))),128))]),_:1})])):C("",!0),s("div",$e,[s("div",Ne,[t[3]||(t[3]=s("span",{class:"label"},"数量：",-1)),v(N(G),{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=k=>g.value=k),min:1,max:e.value.stock,disabled:e.value.stock<=0},null,8,["modelValue","max","disabled"])]),s("div",xe,[v(u,{type:"warning",icon:N(H),onClick:y},{default:f(()=>t[4]||(t[4]=[S(" 收藏商品 ")])),_:1},8,["icon"]),v(u,{type:"primary",icon:N(J),onClick:h,disabled:e.value.stock<=0},{default:f(()=>t[5]||(t[5]=[S(" 加入购物车 ")])),_:1},8,["icon","disabled"])])])])])]),_:1})):(a(),b(P,{key:1,description:"商品不存在"})),e.value?(a(),b(de,{key:2,"product-id":Number(N(V).params.id)},null,8,["product-id"])):C("",!0)])),[[I,m.value]])}}}),ze=B(De,[["__scopeId","data-v-91853cc7"]]);export{ze as default};
