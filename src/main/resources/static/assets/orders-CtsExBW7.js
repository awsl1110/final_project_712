import{d as E,r as C,n as I,o as c,c as d,b as m,w as i,e as s,I as P,q as y,G as x,H as B,g as q,E as o,h as p,J as L,t as r,u as h,f,M as k,S as R,Q as j,R as w,_ as F}from"./index-D07GUNLX.js";import{g as G,a as H,d as J,u as Q}from"./order-D29R81T9.js";import{f as Y}from"./date-D_0JMZE-.js";import"./user-B44x33Ff.js";const K={class:"orders-container"},U={class:"orders-content"},W={class:"order-header"},X={class:"order-info"},Z={class:"order-number"},ee={class:"order-time"},te={class:"order-status"},se={class:"order-items"},ae={class:"item-info"},oe={class:"item-details"},ne={class:"item-name"},ce={class:"item-price"},re={class:"subtotal"},ie={class:"order-footer"},le={class:"order-total"},de={class:"amount-detail"},ue={key:0},_e={class:"final-amount"},me={class:"order-actions"},pe=E({__name:"orders",setup(fe){const T=q(),u=C([]),v=C(!0),b=async()=>{try{v.value=!0;const t=await G();t.data.code===200?u.value=t.data.data:t.data.code===500?o.error("服务器内部错误"):o.error(t.data.message||"获取订单列表失败")}catch(t){console.error("获取订单列表失败:",t),o.error("网络错误，请稍后重试")}finally{v.value=!1}},N=async t=>{try{await w.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=(await H(t.id)).data;l.code===200?(t.status=4,o.success("订单已取消")):o.error(l.message||"取消订单失败")}catch(e){e!=="cancel"&&o.error("取消订单失败")}},D=async t=>{try{await w.confirm("确定要删除这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await J(t.id,{});console.log("删除订单响应:",e),e.data.code===200&&e.data.data?(u.value=u.value.filter(l=>l.id!==t.id),o.success("删除成功")):(console.log("删除失败，响应数据:",e),o.error(e.data.message||"删除失败"))}catch(e){e!=="cancel"&&(console.error("删除订单错误:",e),o.error("删除失败"))}},M=t=>({0:"待付款",1:"待发货",2:"已发货",3:"已完成",4:"已取消"})[t]||"未知状态",_=t=>t==null?"¥0.00":t.toLocaleString("zh-CN",{style:"currency",currency:"CNY"}),z=t=>{T.push(`/order/${t}`)},O=async t=>{try{await w.confirm("确认付款？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await Q(t.id,1,{});console.log("支付响应:",e),e.data.code===200&&e.data.data?(t.status=1,o.success("付款成功")):(console.log("支付失败，响应数据:",e),o.error(e.data.message||"付款失败"))}catch(e){e!=="cancel"&&o.error("付款失败")}};return I(()=>{b()}),(t,e)=>{const l=p("el-card"),S=p("el-empty"),V=p("el-tag"),$=p("el-image"),g=p("el-button"),A=L("loading");return c(),d("div",K,[m(l,{class:"page-header"},{header:i(()=>e[0]||(e[0]=[s("div",{class:"header"},[s("span",{class:"title"},"我的订单")],-1)])),_:1}),P((c(),d("div",U,[u.value.length===0?(c(),y(S,{key:0,description:"暂无订单"})):(c(!0),d(x,{key:1},B(u.value,a=>(c(),y(l,{key:a.id,class:"order-card"},{header:i(()=>[s("div",W,[s("div",X,[s("span",Z,"订单号："+r(a.id),1),s("span",ee,"下单时间："+r(h(Y)(a.createTime)),1)]),s("div",te,[m(V,{type:a.status===4?"info":a.status===0?"warning":"success"},{default:i(()=>[f(r(M(a.status)),1)]),_:2},1032,["type"])])])]),default:i(()=>[s("div",se,[(c(!0),d(x,null,B(a.items,n=>(c(),d("div",{key:n.id,class:"order-item"},[s("div",ae,[m($,{src:n.productImage||"/default-product.jpg",fit:"cover",class:"item-image"},null,8,["src"]),s("div",oe,[s("h3",ne,r(n.productName),1),s("div",ce,[s("span",null,r(_(n.productPrice))+" × "+r(n.quantity),1),s("span",re,"小计："+r(_(n.subtotal)),1)])])])]))),128))]),s("div",ie,[s("div",le,[s("div",de,[s("p",null,"商品总额："+r(_(a.totalAmount)),1),a.discountAmount>0?(c(),d("p",ue,"优惠金额：-"+r(_(a.discountAmount)),1)):k("",!0),s("p",_e,"实付金额："+r(_(a.payAmount)),1)])]),s("div",me,[a.status===0?(c(),y(g,{key:0,type:"primary",size:"small",onClick:n=>O(a)},{default:i(()=>e[1]||(e[1]=[f(" 去付款 ")])),_:2},1032,["onClick"])):k("",!0),a.status!==4?(c(),y(g,{key:1,type:"warning",size:"small",onClick:n=>N(a)},{default:i(()=>e[2]||(e[2]=[f(" 取消订单 ")])),_:2},1032,["onClick"])):k("",!0),m(g,{type:"info",size:"small",icon:h(R),onClick:n=>z(a.id)},{default:i(()=>e[3]||(e[3]=[f(" 订单详情 ")])),_:2},1032,["icon","onClick"]),m(g,{type:"danger",size:"small",icon:h(j),onClick:n=>D(a)},{default:i(()=>e[4]||(e[4]=[f(" 删除订单 ")])),_:2},1032,["icon","onClick"])])])]),_:2},1024))),128))])),[[A,v.value]])])}}}),ke=F(pe,[["__scopeId","data-v-b16245eb"]]);export{ke as default};
