import{a as B,r as D}from"./coupon-DZ01F3Zd.js";import{f as h}from"./date-D_0JMZE-.js";import{d as N,r as y,n as V,o as i,c as m,b as k,w as p,e,I as E,q as f,G as I,H as M,E as a,h as d,J as T,M as A,t as r,u as b,f as S,_ as q}from"./index-D07GUNLX.js";import"./user-B44x33Ff.js";const F={class:"coupons-container"},G={class:"coupon-card"},H={class:"coupon-content"},J={class:"coupon-left"},L={class:"amount"},R={key:0,class:"currency"},$={class:"value"},j={class:"unit"},z={class:"condition"},K={class:"coupon-right"},O={class:"coupon-name"},P={class:"coupon-info"},Q={class:"info-item"},U={class:"text"},W={class:"info-item"},X={class:"text"},Y=N({__name:"coupons",setup(Z){const u=y([]),v=y(!0),g=async()=>{var l,o,c;try{v.value=!0;const s=await B();s.data.code===200?u.value=s.data.data||[]:a.error(s.data.message||"获取优惠券列表失败")}catch(s){((l=s.response)==null?void 0:l.status)===401?a.error("请先登录"):(c=(o=s.response)==null?void 0:o.data)!=null&&c.message?a.error(s.response.data.message):a.error("获取优惠券列表失败")}finally{v.value=!1}},C=async l=>{var c,s,_;if(!localStorage.getItem("token")){a.warning("请先登录");return}if(l.remain<=0){a.warning("优惠券已被领完");return}try{const n=await D(l.id);n.data.code===200?(a.success(n.data.message||"领取成功"),g()):a.error(n.data.message||"领取失败")}catch(n){((c=n.response)==null?void 0:c.status)===401?a.error("请先登录"):(_=(s=n.response)==null?void 0:s.data)!=null&&_.message?a.error(n.response.data.message):a.error("领取失败，请稍后重试")}};return V(()=>{g()}),(l,o)=>{const c=d("el-card"),s=d("el-empty"),_=d("el-button"),n=d("el-col"),w=d("el-row"),x=T("loading");return i(),m("div",F,[k(c,{class:"page-header"},{header:p(()=>o[0]||(o[0]=[e("div",{class:"header"},[e("div",{class:"title-section"},[e("span",{class:"title"},"优惠券中心"),e("span",{class:"subtitle"},"领取优惠券，享受优惠价格")])],-1)])),_:1}),E((i(),m("div",null,[u.value.length===0?(i(),f(s,{key:0,description:"暂无可用优惠券"})):(i(),f(w,{key:1,gutter:20},{default:p(()=>[(i(!0),m(I,null,M(u.value,t=>(i(),f(n,{key:t.id,xs:24,sm:24,md:12,lg:8,class:"mb-4"},{default:p(()=>[e("div",G,[e("div",H,[e("div",J,[e("div",L,[t.type===1?(i(),m("span",R,"¥")):A("",!0),e("span",$,r(t.value),1),e("span",j,r(t.type===1?"元":"折"),1)]),e("div",z," 满"+r(t.minAmount)+"元可用 ",1)]),e("div",K,[e("h3",O,r(t.name),1),e("div",P,[e("div",Q,[o[1]||(o[1]=e("span",{class:"label"},"有效期",-1)),e("span",U,r(b(h)(t.startTime))+" 至 "+r(b(h)(t.endTime)),1)]),e("div",W,[o[2]||(o[2]=e("span",{class:"label"},"剩余数量",-1)),e("span",X,r(t.remain)+"张",1)])]),k(_,{type:"danger",disabled:t.remain<=0,onClick:ee=>C(t),class:"receive-btn"},{default:p(()=>[S(r(t.remain<=0?"已领完":"立即领取"),1)]),_:2},1032,["disabled","onClick"])])])])]),_:2},1024))),128))]),_:1}))])),[[x,v.value]])])}}}),ne=q(Y,[["__scopeId","data-v-a66388a2"]]);export{ne as default};
