import{d as S,r as V,j as z,n as P,p as C,o as R,q as j,w as t,b as e,u as s,e as u,f as c,t as b,s as q,g as D,E as i,h as a,v as F,x as G,y as H,z as J,A as K,B as L,_ as O}from"./index-Ba8PhKSB.js";import{u as Q}from"./user-CswI-_sj.js";const W={class:"header-right"},X={class:"el-dropdown-link"},Y={class:"username"},Z=S({__name:"index",setup($){const A=q(),g=D(),n=Q(),w=V();z(()=>n.token,_=>{_&&C(()=>{setTimeout(()=>{n.fetchAvatar().catch(()=>{})},1e3)})}),P(()=>{n.token&&C(()=>{setTimeout(()=>{n.fetchAvatar().catch(()=>{})},1e3)})});const T=_=>{var o;switch(_){case"profile":g.push("/profile");break;case"upload":(o=w.value)==null||o.click();break;case"password":g.push("/password");break;case"logout":n.logout(),g.push("/login");break}},B=async _=>{var d,f;const o=_.target,l=(d=o.files)==null?void 0:d[0];if(l){const p=i.info({message:"正在上传头像，请稍候...",duration:0});try{const r=await n.uploadAvatar(l);p.close(),r===!0?i.success("头像上传成功"):i.warning("头像可能已上传，请刷新页面查看")}catch(r){console.error("上传错误:",r),p.close(),n.avatarUrl?i.success("头像上传成功"):((f=r.message)!=null&&f.includes("请刷新页面")?i.warning(r.message):r.message?i.error(r.message):i.error("头像上传失败，请重试"),setTimeout(()=>{n.fetchAvatar().catch(()=>{})},1e3))}}o.value=""};return(_,o)=>{const l=a("el-icon"),d=a("el-menu-item"),f=a("el-menu"),p=a("el-aside"),r=a("el-avatar"),m=a("el-dropdown-item"),U=a("el-dropdown-menu"),E=a("el-dropdown"),I=a("el-header"),M=a("router-view"),N=a("el-main"),v=a("el-container");return R(),j(v,{class:"layout-container"},{default:t(()=>[e(p,{width:"200px"},{default:t(()=>[e(f,{"default-active":s(A).path,class:"el-menu-vertical",router:""},{default:t(()=>[e(d,{index:"/dashboard"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(F))]),_:1}),o[0]||(o[0]=u("span",null,"首页",-1))]),_:1}),e(d,{index:"/products"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(G))]),_:1}),o[1]||(o[1]=u("span",null,"商品列表",-1))]),_:1}),e(d,{index:"/cart"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(H))]),_:1}),o[2]||(o[2]=u("span",null,"购物车",-1))]),_:1}),e(d,{index:"/orders"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(J))]),_:1}),o[3]||(o[3]=u("span",null,"我的订单",-1))]),_:1}),e(d,{index:"/favorites"},{default:t(()=>[e(l,null,{default:t(()=>[e(s(K))]),_:1}),o[4]||(o[4]=u("span",null,"我的收藏",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(v,null,{default:t(()=>[e(I,null,{default:t(()=>[u("div",W,[e(E,{onCommand:T},{dropdown:t(()=>[e(U,null,{default:t(()=>[e(m,{command:"profile"},{default:t(()=>o[5]||(o[5]=[c("个人信息")])),_:1}),e(m,{command:"upload"},{default:t(()=>o[6]||(o[6]=[c("上传头像")])),_:1}),e(m,{command:"password"},{default:t(()=>o[7]||(o[7]=[c("修改密码")])),_:1}),e(m,{command:"logout"},{default:t(()=>o[8]||(o[8]=[c("退出登录")])),_:1})]),_:1})]),default:t(()=>{var x;return[u("span",X,[e(r,{size:32,class:"user-avatar",src:s(n).avatarUrl,onError:()=>!0},{default:t(()=>{var h,k,y;return[c(b((y=(k=(h=s(n).userProfile)==null?void 0:h.name)==null?void 0:k.charAt(0))==null?void 0:y.toUpperCase()),1)]}),_:1},8,["src"]),u("span",Y,b((x=s(n).userProfile)==null?void 0:x.name),1),e(l,{class:"el-icon--right"},{default:t(()=>[e(s(L))]),_:1})])]}),_:1})])]),_:1}),e(N,null,{default:t(()=>[e(M)]),_:1})]),_:1}),u("input",{type:"file",ref_key:"fileInput",ref:w,style:{display:"none"},accept:"image/*",onChange:B},null,544)]),_:1})}}}),oe=O(Z,[["__scopeId","data-v-7068fe6e"]]);export{oe as default};
