import{d as J,r as y,F as K,n as R,o as c,c as h,b as a,w as t,e as d,f as i,G as D,H as F,I as O,q as f,g as Q,E as l,h as r,J as W,t as _,u as k,K as X,L as Y,M as I,A as Z,y as ee,_ as te}from"./index-D07GUNLX.js";import{g as se,a as ae,b as oe}from"./product-C-gLdrzQ.js";import{a as ne}from"./cart-BDXYFz_L.js";import{a as le}from"./favorite-Bs-eO1ak.js";import"./user-B44x33Ff.js";const re={class:"p-4"},ce={class:"d-flex justify-content-between align-items-center flex-wrap gap-4"},ie={class:"d-flex align-items-center gap-2"},de={class:"mt-5"},_e={class:"image-placeholder d-flex justify-content-center align-items-center"},ue={class:"image-placeholder d-flex justify-content-center align-items-center flex-column gap-2"},fe={class:"p-4"},me={class:"mb-3"},pe={class:"d-flex justify-content-between align-items-center mb-3"},ge={class:"d-flex gap-2"},ve=J({__name:"products",setup(ye){const x=Q(),p=y([]),C=y([]),m=y(null),g=y(!0),N=async()=>{try{const s=(await se()).data;s.code===200?C.value=s.data:l.error(s.message||"获取商品分类失败")}catch{l.error("获取商品分类失败")}},z=K(()=>m.value?p.value.filter(o=>o.categoryId===m.value):p.value),V=async()=>{try{const s=(await ae()).data;s.code===200?p.value=s.data:l.error(s.message||"获取商品列表失败")}catch{l.error("获取商品列表失败")}finally{g.value=!1}},S=async o=>{g.value=!0,m.value=o;try{if(o===null)await V();else{const n=(await oe(o)).data;n.code===200?p.value=n.data:l.error(n.message||"获取商品列表失败")}}catch{l.error("获取商品列表失败")}finally{g.value=!1}},U=async o=>{if(!localStorage.getItem("token")){l.warning("请先登录");return}try{const n={productId:o.id,quantity:1},u=await ne(n);if(u.data){const v=u.data;v.code===200?l.success("添加到购物车成功"):l.error(v.message||"添加到购物车失败")}else l.error("添加到购物车失败")}catch{l.error("添加到购物车失败")}},A=async o=>{if(!localStorage.getItem("token")){l.warning("请先登录"),x.push("/login");return}try{(await le(o.id)).data.code===200&&l.success("收藏成功")}catch{}},$=o=>{x.push(`/product/${o.id}`)};return R(()=>{V(),N()}),(o,s)=>{const n=r("el-text"),u=r("el-radio-button"),v=r("el-radio-group"),j=r("el-card"),E=r("el-empty"),B=r("el-icon"),L=r("el-image"),M=r("el-link"),b=r("el-tag"),P=r("el-button"),T=r("el-tooltip"),q=r("el-col"),G=r("el-row"),H=W("loading");return c(),h("div",re,[a(j,{class:"mb-4"},{header:t(()=>[d("div",ce,[a(n,{class:"text-xl font-bold"},{default:t(()=>s[1]||(s[1]=[i("商品列表")])),_:1}),d("div",ie,[a(v,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=e=>m.value=e),onChange:S},{default:t(()=>[a(u,{label:null},{default:t(()=>s[2]||(s[2]=[i("全部")])),_:1}),(c(!0),h(D,null,F(C.value,e=>(c(),f(u,{key:e.id,label:e.id},{default:t(()=>[i(_(e.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])])]),_:1}),O((c(),h("div",de,[z.value.length===0?(c(),f(E,{key:0,description:"暂无商品"})):(c(),f(G,{key:1,gutter:20},{default:t(()=>[(c(!0),h(D,null,F(z.value,e=>(c(),f(q,{key:e.id,xs:24,sm:12,md:8,lg:6,class:"mb-5"},{default:t(()=>[a(j,{shadow:"hover","body-style":{padding:0},class:"product-card"},{default:t(()=>[a(L,{src:e.imageUrl||"/default-product.jpg",alt:e.name,class:"w-100 product-image",fit:"cover","preview-src-list":e.imageUrl?[e.imageUrl]:[],"initial-index":0,"preview-teleported":"",loading:"lazy",onClick:w=>$(e)},{placeholder:t(()=>[d("div",_e,[a(B,{size:24,class:"is-loading"},{default:t(()=>[a(k(X))]),_:1})])]),error:t(()=>[d("div",ue,[a(B,{size:30},{default:t(()=>[a(k(Y))]),_:1}),a(n,{class:"text-secondary",size:"small"},{default:t(()=>s[3]||(s[3]=[i("图片加载失败")])),_:1})])]),_:2},1032,["src","alt","preview-src-list","onClick"]),d("div",fe,[a(M,{underline:!1,onClick:w=>$(e)},{default:t(()=>[a(n,{class:"mb-3 text-truncate d-block",style:{"font-size":"16px"}},{default:t(()=>[i(_(e.name),1)]),_:2},1024)]),_:2},1032,["onClick"]),a(n,{type:"info",class:"mb-3 text-truncate d-block"},{default:t(()=>[i(_(e.description),1)]),_:2},1024),d("div",me,[e.brand?(c(),f(b,{key:0,size:"small",effect:"plain",class:"me-2"},{default:t(()=>[i(_(e.brand),1)]),_:2},1024)):I("",!0),e.model?(c(),f(b,{key:1,size:"small",effect:"plain"},{default:t(()=>[i(_(e.model),1)]),_:2},1024)):I("",!0)]),d("div",pe,[a(n,{type:"danger",class:"fs-4"},{default:t(()=>[i(" ¥"+_(e.price.toLocaleString()),1)]),_:2},1024),d("div",ge,[a(T,{content:"收藏",placement:"top","show-after":500},{default:t(()=>[a(P,{type:"warning",icon:k(Z),circle:"",plain:"",onClick:w=>A(e)},null,8,["icon","onClick"])]),_:2},1024),a(T,{content:e.stock<=0?"暂无库存":"加入购物车",placement:"top","show-after":500},{default:t(()=>[a(P,{type:"primary",icon:k(ee),circle:"",plain:"",disabled:e.stock<=0,onClick:w=>U(e)},null,8,["icon","disabled","onClick"])]),_:2},1032,["content"])])]),a(b,{type:e.stock>0?"success":"danger",size:"small",effect:"light"},{default:t(()=>[i(_(e.stock>0?`库存: ${e.stock}`:"无货"),1)]),_:2},1032,["type"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}))])),[[H,g.value]])])}}}),Ce=te(ve,[["__scopeId","data-v-3e17ca53"]]);export{Ce as default};
