import{d as F,r as p,F as E,n as q,o,c as l,b as _,w as f,e as t,t as d,M as C,G as T,H as U,E as u,h as i,q as b,_ as B,I as L,f as R,u as S,s as M,J,A as j,y as G}from"./index-D07GUNLX.js";import{c as H}from"./product-C-gLdrzQ.js";import{a as O}from"./cart-BDXYFz_L.js";import{a as Y}from"./favorite-Bs-eO1ak.js";import{g as K}from"./review-DIY5lUzj.js";import"./user-B44x33Ff.js";const Q={class:"product-reviews"},W={class:"review-header"},X={key:0,class:"rating-summary"},Z={class:"review-count"},ee={key:0,class:"loading-container"},te={key:1,class:"empty-reviews"},se={key:2,class:"review-list"},ae={class:"review-item-header"},oe={class:"review-time"},ne={class:"review-content"},re={key:0,class:"review-images"},le={key:3,class:"pagination"},ce=F({__name:"ProductReviews",props:{productId:{}},setup(z){const V=z,m=p(!0),e=p([]),g=p(1),x=p(10),w=p(0),k=p(0),$=E(()=>{if(e.value.length===0)return 0;const s=e.value.reduce((c,v)=>c+v.rating,0);return Number((s/e.value.length).toFixed(1))}),N=s=>new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),n=async()=>{m.value=!0;try{const s=await K(V.productId);if(s.data.code===200){const{records:c,totalPage:v,totalRow:h}=s.data.data;e.value=c,w.value=v,k.value=h}}catch(s){s.message==="此商品无评价"?(e.value=[],w.value=0,k.value=0):(u.error("获取商品评价失败"),console.error("获取商品评价失败:",s))}finally{m.value=!1}},a=s=>{g.value=s,n()};return q(()=>{n()}),(s,c)=>{const v=i("el-rate"),h=i("el-skeleton"),P=i("el-image"),D=i("el-pagination"),I=i("el-card");return o(),l("div",Q,[_(I,{class:"review-card"},{header:f(()=>[t("div",W,[c[2]||(c[2]=t("span",{class:"title"},"商品评价",-1)),e.value.length>0?(o(),l("div",X,[_(v,{modelValue:$.value,"onUpdate:modelValue":c[0]||(c[0]=r=>$.value=r),disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"},null,8,["modelValue"]),t("span",Z,"( "+d(e.value.length)+" 条评价 )",1)])):C("",!0)])]),default:f(()=>[m.value?(o(),l("div",ee,[_(h,{rows:3,animated:""})])):e.value.length===0?(o(),l("div",te," 暂无评价 ")):(o(),l("div",se,[(o(!0),l(T,null,U(e.value,r=>(o(),l("div",{key:r.id,class:"review-item"},[t("div",ae,[_(v,{modelValue:r.rating,"onUpdate:modelValue":y=>r.rating=y,disabled:""},null,8,["modelValue","onUpdate:modelValue"]),t("span",oe,d(N(r.createTime)),1)]),t("div",ne,d(r.content),1),r.images?(o(),l("div",re,[(o(!0),l(T,null,U(r.images.split(","),(y,A)=>(o(),b(P,{key:A,src:y,"preview-src-list":r.images.split(","),fit:"cover",class:"review-image"},null,8,["src","preview-src-list"]))),128))])):C("",!0)]))),128))])),w.value>1?(o(),l("div",le,[_(D,{"current-page":g.value,"onUpdate:currentPage":c[1]||(c[1]=r=>g.value=r),"page-size":x.value,total:k.value,onCurrentChange:a,layout:"prev, pager, next"},null,8,["current-page","page-size","total"])])):C("",!0)]),_:1})])}}}),ie=B(ce,[["__scopeId","data-v-95d2771a"]]),de={class:"product-detail-container"},ue={class:"product-content"},pe={class:"product-image"},_e=["src","alt"],ve={class:"product-info"},me={class:"product-name"},ge={class:"product-meta"},fe={class:"brand"},he={class:"model"},ye={class:"product-price"},we={class:"price"},ke={class:"stock"},be={class:"product-description"},Ce={key:0,class:"product-specs"},Ve={class:"product-actions"},$e={class:"quantity-selector"},xe={class:"action-buttons"},Ne=F({__name:"product-detail",setup(z){const V=M(),m=p(!0),e=p(null),g=p(1),x=async()=>{try{m.value=!0;const n=Number(V.params.id),s=(await H(n)).data;s.code===200?e.value=s.data:u.error(s.message||"获取商品详情失败")}catch{u.error("获取商品详情失败")}finally{m.value=!1}},w=async()=>{if(e.value)try{const n={productId:e.value.id,quantity:g.value},a=await O(n);if(a.data){const s=a.data;s.code===200?u.success("添加到购物车成功"):u.error(s.message||"添加到购物车失败")}else u.error("添加到购物车失败")}catch{u.error("添加到购物车失败")}},k=async()=>{if(!e.value)return;if(!localStorage.getItem("token")){u.warning("请先登录");return}try{(await Y(e.value.id)).data.code===200&&u.success("收藏成功")}catch{}},$=n=>n==null?"¥0.00":n.toLocaleString("zh-CN",{style:"currency",currency:"CNY"}),N=n=>{if(!n)return{};try{return JSON.parse(n)}catch{return{}}};return q(()=>{x()}),(n,a)=>{const s=i("el-descriptions-item"),c=i("el-descriptions"),v=i("el-input-number"),h=i("el-button"),P=i("el-card"),D=i("el-empty"),I=J("loading");return L((o(),l("div",de,[e.value?(o(),b(P,{key:0,class:"product-detail"},{default:f(()=>[t("div",ue,[t("div",pe,[t("img",{src:e.value.imageUrl||"/default-product.jpg",alt:e.value.name},null,8,_e)]),t("div",ve,[t("h1",me,d(e.value.name),1),t("div",ge,[t("span",fe,"品牌："+d(e.value.brand),1),t("span",he,"型号："+d(e.value.model),1)]),t("div",ye,[t("span",we,d($(e.value.price)),1),t("span",ke,"库存："+d(e.value.stock)+"件",1)]),t("div",be,[a[1]||(a[1]=t("h3",null,"商品描述",-1)),t("p",null,d(e.value.description),1)]),e.value.specifications?(o(),l("div",Ce,[a[2]||(a[2]=t("h3",null,"商品规格",-1)),_(c,{column:1,border:""},{default:f(()=>[(o(!0),l(T,null,U(N(e.value.specifications),(r,y)=>(o(),b(s,{key:y,label:y},{default:f(()=>[R(d(r),1)]),_:2},1032,["label"]))),128))]),_:1})])):C("",!0),t("div",Ve,[t("div",$e,[a[3]||(a[3]=t("span",{class:"label"},"数量：",-1)),_(v,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=r=>g.value=r),min:1,max:e.value.stock,disabled:e.value.stock<=0},null,8,["modelValue","max","disabled"])]),t("div",xe,[_(h,{type:"warning",icon:S(j),onClick:k},{default:f(()=>a[4]||(a[4]=[R(" 收藏商品 ")])),_:1},8,["icon"]),_(h,{type:"primary",icon:S(G),onClick:w,disabled:e.value.stock<=0},{default:f(()=>a[5]||(a[5]=[R(" 加入购物车 ")])),_:1},8,["icon","disabled"])])])])])]),_:1})):(o(),b(D,{key:1,description:"商品不存在"})),e.value?(o(),b(ie,{key:2,"product-id":Number(S(V).params.id)},null,8,["product-id"])):C("",!0)])),[[I,m.value]])}}}),Ue=B(Ne,[["__scopeId","data-v-2f3a9dd4"]]);export{Ue as default};
