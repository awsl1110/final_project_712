import{d as N,r as _,a as S,j as y,D as q,o as B,c as R,b as r,w as o,e as g,u as w,f as C,t as D,g as j,E as c,h as m,l as v,m as A,k as M,_ as T}from"./index-D07GUNLX.js";import{u as $,a as z}from"./user-B44x33Ff.js";const G={class:"password-container"},H={class:"code-container"},J=N({__name:"password",setup(K){const x=j(),P=$(),f=_(!1),n=_(0);let i=null;const a=S({oldPassword:"",newPassword:"",emailCode:"",confirmPassword:"",email:""}),b=(l,e,s)=>{var d;if(!e){s(new Error("请输入新密码"));return}if(e===a.oldPassword){s(new Error("新密码不能与原密码相同"));return}if(e.length<6||e.length>20){s(new Error("密码长度在6-20个字符之间"));return}a.confirmPassword&&((d=p.value)==null||d.validateField("confirmPassword")),s()},E=(l,e,s)=>{if(!e){s(new Error("请再次输入密码"));return}if(e!==a.newPassword){s(new Error("两次输入密码不一致"));return}s()};y(()=>a.newPassword,l=>{var e;l&&a.confirmPassword&&((e=p.value)==null||e.validateField("confirmPassword"))},{immediate:!0}),y(()=>a.confirmPassword,l=>{var e;l&&a.newPassword&&((e=p.value)==null||e.validateField("confirmPassword"))},{immediate:!0});const h={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6-20个字符之间",trigger:"blur"}],newPassword:[{validator:b,trigger:["blur","change"]}],confirmPassword:[{validator:E,trigger:["blur","change"]}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],emailCode:[{required:!0,message:"请输入邮箱验证码",trigger:"blur"},{len:6,message:"验证码长度必须为6位",trigger:"blur"}]},p=_(),U=async()=>{try{f.value=!0,await z.sendEmailCode(a.email),c.success("验证码已发送到您的邮箱"),n.value=60,i=setInterval(()=>{n.value>0?n.value--:i&&(clearInterval(i),i=null)},1e3)}catch(l){c.error(l.message||"发送失败")}finally{f.value=!1}};q(()=>{i&&clearInterval(i)});const k=async()=>{var l;try{await((l=p.value)==null?void 0:l.validate()),f.value=!0,await P.updatePassword(a),c.success("密码修改成功，请重新登录"),P.logout(),x.push("/login")}catch(e){e.message?c.error(e.message):c.error("修改失败")}finally{f.value=!1}};return(l,e)=>{const s=m("el-icon"),d=m("el-input"),u=m("el-form-item"),V=m("el-button"),F=m("el-form"),I=m("el-card");return B(),R("div",G,[r(I,{class:"password-card"},{header:o(()=>e[5]||(e[5]=[g("div",{class:"card-header"},[g("span",null,"修改密码")],-1)])),default:o(()=>[r(F,{ref_key:"formRef",ref:p,model:a,rules:h},{default:o(()=>[r(u,{prop:"oldPassword"},{default:o(()=>[r(d,{modelValue:a.oldPassword,"onUpdate:modelValue":e[0]||(e[0]=t=>a.oldPassword=t),type:"password",placeholder:"原密码"},{prefix:o(()=>[r(s,null,{default:o(()=>[r(w(v))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(u,{prop:"newPassword"},{default:o(()=>[r(d,{modelValue:a.newPassword,"onUpdate:modelValue":e[1]||(e[1]=t=>a.newPassword=t),type:"password",placeholder:"新密码"},{prefix:o(()=>[r(s,null,{default:o(()=>[r(w(v))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(u,{prop:"confirmPassword"},{default:o(()=>[r(d,{modelValue:a.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=t=>a.confirmPassword=t),type:"password",placeholder:"确认新密码"},{prefix:o(()=>[r(s,null,{default:o(()=>[r(w(v))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(u,{prop:"email"},{default:o(()=>[g("div",H,[r(d,{modelValue:a.email,"onUpdate:modelValue":e[3]||(e[3]=t=>a.email=t),placeholder:"请输入邮箱"},{prefix:o(()=>[r(s,null,{default:o(()=>[r(w(A))]),_:1})]),_:1},8,["modelValue"]),r(V,{disabled:!!n.value||!a.email,onClick:U},{default:o(()=>[C(D(n.value?`${n.value}s后重试`:"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1}),r(u,{prop:"emailCode"},{default:o(()=>[r(d,{modelValue:a.emailCode,"onUpdate:modelValue":e[4]||(e[4]=t=>a.emailCode=t),placeholder:"邮箱验证码"},{prefix:o(()=>[r(s,null,{default:o(()=>[r(w(M))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(u,null,{default:o(()=>[r(V,{type:"primary",loading:f.value,onClick:k,block:""},{default:o(()=>e[6]||(e[6]=[C(" 确认修改 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})])}}}),Q=T(J,[["__scopeId","data-v-886a3d94"]]);export{Q as default};
